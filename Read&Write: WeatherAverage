#The formula for a k day moving average over a series -  ğ‘›0,ğ‘›1,ğ‘›2,ğ‘›3....ğ‘›ğ‘š is:
#ğ‘€ğ‘–=ğ‘€ğ‘–âˆ’1+ğ‘›ğ‘–âˆ’ğ‘›ğ‘–âˆ’ğ‘˜ğ‘˜,for i = k to m where ğ‘€ğ‘– is the moving average

import matplotlib.pyplot as plt

statData ="ex4.csv"

def getNAvg(file,N):
    """
    file - File containting all the raw weather station data
    N - The number of days to compute the moving average over
    
    Return a list of containg the moving average of all data points
    """
    row = 0 # keep track of rows
    lastN = [] # keep track of last N points
    mean = [0] # running avg
    
    
    with open(file,"r") as rawData: 
        for line in rawData:
            if (row == 0): # Ignore the headers
                row = row + 1
                continue
            
            line = line.strip('\n')
            lineData = float(line.split(',')[1])
            
            if (row<=N): 
                lastN.append(lineData)
                mean[0] = (lineData + mean[0]*(row-1))/row
            else:
                mean.append( mean[row - N -1]+ (lineData - lastN[0])/N)
                lastN = lastN[1:]
                lastN.append(lineData)
            
            row = row +1            
        return mean
                    
def plotData(mean,N):
        """ Plots running averages """
        mean = [round(x,3) for x in mean]
        plt.plot(mean,label=str(N) + ' day average')
        plt.xlabel('Day')
        plt.ylabel('Precipiation')
        plt.legend()
       

        
plotData(getNAvg(statData,1),1)
plotData ([0 for x in range(1,5)]+ getNAvg(statData,5),5 )
plotData([0 for x in range(1,7)] + getNAvg(statData,7),7)
